# تكوين قاعدة عامة
input AMPLIFY { globalAuthRule: AuthRule = { allow: public } }

type Post
  @model
  @auth(rules: [
    { allow: owner, operations: [create, update, delete, read] },
    { allow: private, operations: [read, update] } # Added update permission for signed-in users
    { allow: public, operations: [read] }
  ]) {
  id: ID!
  content: String!
  userEmail: String!                       # إيميل صاحب البوست (ممكن يكون فاضي)
  owner: String
  createdAt: AWSDateTime!
  likes: [String]             # إيميلات اللي عملوا like
  dislikes: [String]          # إيميلات اللي عملوا dislike
  comments: [PostComment] @hasMany(indexName: "byPost", fields: ["id"])
}
type PostComment
  @model
  @auth(rules: [
    { allow: owner, operations: [update, delete, read] }, # المالك يتحكم بالكومنت حقه
    { allow: private, operations: [create, read] },       # أي مستخدم مسجّل دخول يقدر يعمل كومنت ويقرأ
    { allow: public, operations: [read] }                 # الزوار يقرأوا فقط
  ]) {
  id: ID!
  postID: ID! @index(name: "byPost")
  content: String!
  userEmail: String!
  createdAt: AWSDateTime!
  post: Post @belongsTo(fields: ["postID"])
}
